
test_that("datatable_read_vector() : CREATE Datatables", {

  # test datatable_read_vector() can read all types of datatable into tibbles correctly
  # testing al kinds of data permutations

  # test reading CREATE :

  #### no reps ####

  # all lengths of data cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # multiple data points per ID in data cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "              2      30.1      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1002     F      31.0      2020-01-02:12:01        F4M3PB_RT          fix_RT     ",
    "              2      31.1      2020-01-02:12:02        F4M4PB_RT                     ",
    "                                                                                     ",
    "     1003     M      32.0      2020-01-03:12:01        F4M5PB_4C          fix_4C     ",
    "              2      32.1      2020-01-03:12:02        F4M6PB_RT                     ",
    "                                                                                     ",
    "     1004     M      33.0      2020-01-04:12:01        F4M7PB_4C          fix_4C     ",
    "              2      33.1      2020-01-04:12:02        F4M8PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # adding IDs to separate CREATE datatables of same name : combine_with_existing
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1005     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1006     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1007     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1008     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))


  # edge cases

  # check blank list returned with only one dt delimiter
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                  ",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # check odd number of delimiters are ignored
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # check sensible message returned when no delimiters are present
  contents <- c(
    "",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "")
  expect_snapshot(datatable_read_vector(contents))


  # test ERRORS
  # check CREATE datatable with two identical IDs fails
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1001     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # check CREATING two datatables with same NAME and IDs will fail
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # check datatable CREATE first col must be ID
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      DI      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # check CREATING two datatables with different COL NAMES will fail
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1003     F      30.0      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

})


test_that("datatable_read_vector() : RESAMPLE Datatables", {

  # test reading RESAMPLE :

  #### no reps ####

  # test resample with 1 rep per sub-sample
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          1     ",
    "              SC           1     ",
    "                                 ",
    "     1002     CNS          1     ",
    "              SC           1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with 1 rep per sub-sample - resampled across 2 datatables
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          1     ",
    "              SC           1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          1     ",
    "              SC           1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with multiple reps per sub-sample
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with IDs in different order
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "     1001     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with MIXTURE of RESAMPLE reps 1 + SEPARATE RESAMPLE reps > 1
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          3     ",
    "              SC           1     ",
    "                                 ",
    "     1001     CNS          3     ",
    "              SC           1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with MIXTURE of RESAMPLE reps 1 and more than 1
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          3     ",
    "              SC           2     ",
    "              DRG          1     ",
    "                                 ",
    "     1001     CNS          3     ",
    "              SC           1     ",
    "              DRG          1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with MIXTURE of reps 1 + reps > 1 - IDs in different order : SC
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          3     ",
    "              SC           1     ",
    "              DRG          1     ",
    "                                 ",
    "     1001     CNS          3     ",
    "              SC           2     ",
    "              DRG          1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test across RESAMPLE dts that 1 rep then multiple reps are properly handled
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1002     CNS          3     ",
    "              SC           1     ",
    "              DRG          1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "              SC           2     ",
    "              DRG          1     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # SUCCESS
  # SC initially only has 1 rep from 1002, so no rep col in subsample
  # but when 1001 has subsample SC with 2 reps, a rep col is added and filled with correct reps


  # test ERRORS
  # check RESAMPLE datatable with only two cols fails
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    ",
    "    ======  ==========   ",
    "",
    "     1001     CNS        ",
    "              SC         ",
    "                         ",
    "     1002     CNS        ",
    "              SC         ",
    "                         ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # ID col incorrect
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      DI     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # resample col incorrect
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     rdsample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # reps col incorrect
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    rdps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          3     ",
    "              SC           4     ",
    "                                 ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))


  #### reps ####

  # test resample with multiple reps per sub-sample
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with IDs in different order
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with IDs in different order across RESAMPLE dts
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with IDs in different order across RESAMPLE dts && rep1 -> rep multiple correct handling
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1002     1:2       50µm         4     ",
    "                        100µm        1     ",
    "                                           ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # test resample with mixture of rep 1 in all IDs, reps 1 or more across IDs, reps more across IDs
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        1     ",
    "                        250µm        1     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                        250µm        1     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # correctly adds rep col to subsamples depending on reps defined in reps col
  # if only 1 rep for a given set of IDs in subsample (defined by resmaple String and parent REP)
  # then omits the rep col in subsample datatable
  # eg. samples_CNS-3_100µm : has no rep col - as only 1001 parent has rep 3

  # test resample with mixture of rep 1 in all IDs, reps 1 or more across IDs, reps more across IDs
  # AND across resample tables
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          3     ",
    "              SC           3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:2       50µm         4     ",
    "                        100µm        1     ",
    "                        250µm        1     ",
    "                                           ",
    "     1002     1:3       50µm         4     ",
    "                        100µm        4     ",
    "                        250µm        1     ",
    "                                           ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     3:4       50µm         4     ",
    "                        100µm        1     ",
    "                        250µm        1     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS


  ### ERRORS

  # incorrect ID col name
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      DI      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # incorrect rep col name
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rdp     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # incorrect resample col name
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     rdsample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # incorrect reps col name
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    rdps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:2       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))

  # error with non-existent reps
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.0      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          4     ",
    "              SC           4     ",
    "                                 ",
    "     1002     CNS          2     ",
    "              SC           2     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  RESAMPLE",
    "",
    "",
    "      ID      rep     resample    reps    ",
    "    ======  =======  ==========  =======  ",
    "",
    "     1001     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "     1002     1:4       50µm         4     ",
    "                        100µm        4     ",
    "                                           ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))


})


test_that("datatable_read_vector() : ADD_DATA Datatables", {

  #### var-cols : no reps ####

  # test add data to non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to subset non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout


  # test add data to subset non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_RT     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                       ",
    "     fix_4C     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to ALL non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test adding to multiple ADD_DATA tables

  # test add data to 2 subsets : non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to subset by group : non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1003     F      33.3      2020-01-01:12:03        F4M3PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_RT     F      31.2      2020-01-01:12:12        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to subset by ALL : non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1003     F      33.3      2020-01-01:12:03        F4M3PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "      ALL       B      31.2      2020-01-01:12:12        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout


  # test with multi-observational data
  # test add data to non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "              1      30.1      2020-01-01:12:01        F4M1PB_RT                     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "              2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "              3      30.3      2020-01-01:12:03        F4M3PB_RT                     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "              4      30.4      2020-01-01:12:04        F4M4PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to subset non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "              2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "              4      30.4      2020-01-01:12:04        F4M4PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to group non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_4C     F      32.4      2020-01-01:12:04        F4M2PB_4C          dix_4C     ",
    "                4      30.4      2020-01-02:12:04        F4M2PB_4C                     ",
    "                                                                                       ",
    "     fix_RT     M      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                2      30.2      2020-01-02:12:02        F4M2PB_RT                     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to ALL non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "              2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1001     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1004     M      33.4      2020-01-01:12:34        F4M3PB_4C          dix_4C     ",
    "              4      33.4      2020-01-01:12:34        F4M4PB_RT                     ",
    "                                                                                     ",
    "     1003     M      33.4      2020-01-01:12:34        F4M3PB_4C          dix_4C     ",
    "              4      33.4      2020-01-01:12:34        F4M4PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to group non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1001     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_4C     F      33.4      2020-01-01:12:34        F4M3PB_4C          dix_4C     ",
    "                4      33.4      2020-01-02:12:34        F4M4PB_4C                     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # test add data to ALL non-rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "     1001     F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "              2      31.2      2020-01-01:12:12        F4M2PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     ALL        F      33.4      2020-01-01:12:34        F4M3PB_4C          dix_4C     ",
    "                4      33.4      2020-01-02:12:34        F4M4PB_4C                     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout


  # ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "              2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  ##### var-cols : no reps : errors #####

  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # check add data to ALL with IDs with data assigned to cols fails
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "      ALL      F      33.3      2020-01-01:12:03        F4M3PB_RT          dix_RT     ",
    "                                                                                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  # check add data to groups with IDs with data assigned to cols fails
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_4C     F      33.4      2020-01-01:12:34        F4M4PB_RT          dix_RT     ",
    "                                                                                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # check add data to groups with IDs with data assigned to cols FAILS
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     fix_4C     F      33.4      2020-01-01:12:34        F4M4PB_RT          dix_RT     ",
    "                                                                                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  # check add data to ALL when ALL IDs have been resampled FAILS
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",

    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "      ALL      F      33.3      2020-01-01:12:03        F4M3PB_RT          dix_RT     ",
    "                                                                                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # check add data to ALL when ALL IDs have been resampled FAILS
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "      1004      F      33.3      2020-01-01:12:03        F4M3PB_RT          dix_RT     ",
    "                                                                                     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con    ",
    "    ========  =====  ========  ====================  =================  ",
    "",
    "      ALL      F      33.3      2020-01-01:12:03        F4M3PB_RT        ",
    "                                                                         ",
    "",
    "+===============================================================================",  "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # error with existing subset headers in ADD_DATA datatable
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID      y      wt-g         derfuse_dt         perfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  # error when trying to add data to ID that has been disposed/resampled/exported
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     1002       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                       ",
    "     1004       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # error when trying to add data to ID that has been disposed/resampled/exported
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_RT     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      ID        y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ========  =====  ========  ====================  =================  =============  ",
    "",
    "     1002       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                       ",
    "     1004       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                2      30.2      2020-01-01:12:02        F4M2PB_RT                     ",
    "                                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE



  #### var-cols : reps ####

  # test add data to rep datatable - reps each line - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to rep datatable - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001    1:3       F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    1:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003    1:3       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004    1:3       M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout



  # test add data to subset rep datatable - reps each line - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subsets rep across datatables - reps each line - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     3        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     3        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subset rep datatable - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    2:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    1:2       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subset rep across datatables - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    2:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    1:2       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001    2:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subset rep datatable - reps ALL - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    ALL       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout

  # test add data to subset rep datatables - reps ALL - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    ALL       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1004    ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subset rep datatable - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL     ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to subset rep datatable - ALL IDs - subset reps? - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      1        F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout
  # ALL defaults to all reps!


  # test add data to rep datatable - reps each line - add to group - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID          z      ft-g         ferfuse_dt         ferfusion_con      group-fix    ",
    "    ========    =====  ========  ====================  =================  =============  ",
    "",
    "     dix_RT       F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",  "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout


  # test add data to rep datatable - reps each line - add to ALL - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID          z      ft-g         ferfuse_dt         ferfusion_con      group-fix    ",
    "    ========    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL          F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",  "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable to reps in variable-col layout

  ##### var-cols : reps : errors #####

  # test fail with duplicated ID-REP
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     1        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # test fail when writing same data cols to ids / reps - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001    1:3       F      31.1      2020-01-01:12:01        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    1:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003    1:3       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004    1:3       M      34.4      2020-01-01:12:04        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1003    1:3       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # test fail when writing same data cols to ids / reps - to subset rep datatable - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",  "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  # test fail when writing same data cols to ids / reps - subset - summarise reps - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    2:3       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    1:2       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1003    1:2       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # test fail when writing same data cols to ids / reps - all reps
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1002    ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "     1003    ALL       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1003    ALL       M      33.3      2020-01-01:12:03        F4M3PB_4C          dix_4C     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # test fail when writing same data cols to ids / reps - ALL - all cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL     ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL     ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  # test fail when writing same data cols to ids / reps - ALL - some cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL     ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       z      ft-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL     ALL       F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # test fail when writing same data cols to ids / reps - ALL - selected REPs
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      1        F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     ALL      1        F      32.2      2020-01-01:12:02        F4M2PB_RT          dix_RT     ",
    "                                                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE
  # ALL defaults to all reps!


  # test add data to rep datatable - reps each line - add to group - variable-cols
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep       y      dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====    =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1        F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     2        F      31.2      2020-01-01:12:12        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1001     3        F      31.3      2020-01-01:12:13        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     1        F      32.1      2020-01-01:12:21        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     2        F      32.2      2020-01-01:12:22        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002     3        F      32.3      2020-01-01:12:23        F4M2PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1003     1        M      33.1      2020-01-01:12:31        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     2        M      33.2      2020-01-01:12:32        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1003     3        M      33.3      2020-01-01:12:33        F4M3PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     1        M      34.1      2020-01-01:12:41        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     2        M      34.2      2020-01-01:12:42        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "     1004     3        M      34.3      2020-01-01:12:43        F4M4PB_4C          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep      z      ft-g         ferfuse_dt         ferfusion_con      group-fix    ",
    "    ======  =====   =====  ========  ====================  =================  =============  ",
    "",
    "     1001     1       F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID          z      ft-g         ferfuse_dt         ferfusion_con      group-fix    ",
    "    ========    =====  ========  ====================  =================  =============  ",
    "",
    "     dix_RT       F      31.1      2020-01-01:12:11        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  #### id-cols : no reps ####
  # ID
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1002                1003                1004         ",
    "    ===============  ==================  ==================  ==================  ==================  ",
    "",
    "     y                F                   F                   M                   M                  ",
    "                                                                                                     ",
    "     dt-g             31.1                32.2                33.3                34.4               ",
    "                                                                                                     ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02    2020-01-01:12:03    2020-01-01:12:04   ",
    "                                                                                                     ",
    "     derfusion_con    F4M1PB_4C           F4M2PB_4C           F4M3PB_4C           F4M4PB_4C          ",
    "                                                                                                     ",
    "     group_dix        dix_RT              dix_RT              dix_4C              dix_4C             ",
    "                                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # ID subset
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1002                 1003         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             32.2                33.3                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:02    2020-01-01:12:03    ",
    "                                                              ",
    "     derfusion_con    F4M2PB_4C           F4M3PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # ID subset x 2 tables
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1002                 1003         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             32.2                33.3                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:02    2020-01-01:12:03    ",
    "                                                              ",
    "     derfusion_con    F4M2PB_4C           F4M3PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1004         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             31.1                34.4                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:04    ",
    "                                                              ",
    "     derfusion_con    F4M1PB_4C           F4M4PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout


  # group
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            fix_RT              fix_4C        ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                M                   F                  ",
    "                                                             ",
    "     dt-g             31.1                32.2               ",
    "                                                             ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02   ",
    "                                                             ",
    "     derfusion_con    F4M1PB_RT           F4M2PB_4C          ",
    "                                                             ",
    "     group_dix        dix_RT              dix_4C             ",
    "                                                             ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # group - subset
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            fix_4C        ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     dt-g             31.1               ",
    "                                         ",
    "     derfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     derfusion_con    F4M1PB_RT          ",
    "                                         ",
    "     group_dix        dix_RT             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))

  # ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            ALL           ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     dt-g             31.1               ",
    "                                         ",
    "     derfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     derfusion_con    F4M1PB_RT          ",
    "                                         ",
    "     group_dix        dix_RT             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  ##### id-cols : no reps : errors #####

  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1002                1003                1004         ",
    "    ===============  ==================  ==================  ==================  ==================  ",
    "",
    "     y                F                   F                   M                   M                  ",
    "                                                                                                     ",
    "     dt-g             31.1                32.2                33.3                34.4               ",
    "                                                                                                     ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02    2020-01-01:12:03    2020-01-01:12:04   ",
    "                                                                                                     ",
    "     derfusion_con    F4M1PB_4C           F4M2PB_4C           F4M3PB_4C           F4M4PB_4C          ",
    "                                                                                                     ",
    "     group_dix        dix_RT              dix_RT              dix_4C              dix_4C             ",
    "                                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1002                1003                1004         ",
    "    ===============  ==================  ==================  ==================  ==================  ",
    "",
    "     y                F                   F                   M                   M                  ",
    "                                                                                                     ",
    "     dt-g             31.1                32.2                33.3                34.4               ",
    "                                                                                                     ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02    2020-01-01:12:03    2020-01-01:12:04   ",
    "                                                                                                     ",
    "     derfusion_con    F4M1PB_4C           F4M2PB_4C           F4M3PB_4C           F4M4PB_4C          ",
    "                                                                                                     ",
    "     group_dix        dix_RT              dix_RT              dix_4C              dix_4C             ",
    "                                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # ID subset
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1002                 1003         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             32.2                33.3                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:02    2020-01-01:12:03    ",
    "                                                              ",
    "     derfusion_con    F4M2PB_4C           F4M3PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1002                 1003         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             32.2                33.3                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:02    2020-01-01:12:03    ",
    "                                                              ",
    "     derfusion_con    F4M2PB_4C           F4M3PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # ID subset x 2 tables
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1002                 1003         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             32.2                33.3                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:02    2020-01-01:12:03    ",
    "                                                              ",
    "     derfusion_con    F4M2PB_4C           F4M3PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1004         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             31.1                34.4                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:04    ",
    "                                                              ",
    "     derfusion_con    F4M1PB_4C           F4M4PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1004         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             31.1                34.4                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:04    ",
    "                                                              ",
    "     derfusion_con    F4M1PB_4C           F4M4PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # group
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1004         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             31.1                34.4                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:04    ",
    "                                                              ",
    "     derfusion_con    F4M1PB_4C           F4M4PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            fix_RT              fix_4C        ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                M                   F                  ",
    "                                                             ",
    "     dt-g             31.1                32.2               ",
    "                                                             ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02   ",
    "                                                             ",
    "     derfusion_con    F4M1PB_RT           F4M2PB_4C          ",
    "                                                             ",
    "     group_dix        dix_RT              dix_4C             ",
    "                                                             ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # group - subset
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1004         ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                F                   M                   ",
    "                                                              ",
    "     dt-g             31.1                34.4                ",
    "                                                              ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:04    ",
    "                                                              ",
    "     derfusion_con    F4M1PB_4C           F4M4PB_4C           ",
    "                                                              ",
    "     group_dix        dix_RT              dix_4C              ",
    "                                                              ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            fix_4C        ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     dt-g             31.1               ",
    "                                         ",
    "     derfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     derfusion_con    F4M1PB_RT          ",
    "                                         ",
    "     group_dix        dix_RT             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1002                1003                1004         ",
    "    ===============  ==================  ==================  ==================  ==================  ",
    "",
    "     y                F                   F                   M                   M                  ",
    "                                                                                                     ",
    "     dt-g             31.1                32.2                33.3                34.4               ",
    "                                                                                                     ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02    2020-01-01:12:03    2020-01-01:12:04   ",
    "                                                                                                     ",
    "     derfusion_con    F4M1PB_4C           F4M2PB_4C           F4M3PB_4C           F4M4PB_4C          ",
    "                                                                                                     ",
    "     group_dix        dix_RT              dix_RT              dix_4C              dix_4C             ",
    "                                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  ADD_DATA",
    "",
    "",
    "      variables            ALL           ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     dt-g             31.1               ",
    "                                         ",
    "     derfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     derfusion_con    F4M1PB_RT          ",
    "                                         ",
    "     group_dix        dix_RT             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE

  #### id-cols : reps ####

  # group
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep     dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "     1003    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      variables            dix_RT              dix_4C        ",
    "    ===============  ==================  ==================  ",
    "",
    "     y                M                   F                  ",
    "                                                             ",
    "     ft-g             31.1                32.2               ",
    "                                                             ",
    "     ferfuse_dt       2020-01-01:12:01    2020-01-01:12:02   ",
    "                                                             ",
    "     ferfusion_con    F4M1PB_RT           F4M2PB_4C          ",
    "                                                             ",
    "     group_fix        fix_RT              fix_4C             ",
    "                                                             ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # group - subset
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep     dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "     1003    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      variables            dix_4C        ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     ft-g             31.1               ",
    "                                         ",
    "     ferfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     ferfusion_con    F4M1PB_4C          ",
    "                                         ",
    "     group_fix        fix_4C             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout

  # ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep     dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "     1003    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      variables            ALL           ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     ft-g             31.1               ",
    "                                         ",
    "     ferfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     ferfusion_con    F4M1PB_4C          ",
    "                                         ",
    "     group_fix        fix_4C             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # read ADD_DATA datatable in variable-col layout


  ##### id-cols : reps : errors #####

  # fails with same col name with ALL data added
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      ID     rep     dt-g         derfuse_dt         derfusion_con      group-dix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1002    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "     1003    ALL     13.3      2020-01-01:11:03        F4M1PB_RT          dix_RT     ",
    "                                                                                     ",
    "     1004    ALL     22.3      2020-01-01:12:23        F4M2PB_RT          dix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      variables            ALL           ",
    "    ===============  ==================  ",
    "",
    "     y                M                  ",
    "                                         ",
    "     ft-g             31.1               ",
    "                                         ",
    "     derfuse_dt       2020-01-01:12:01   ",
    "                                         ",
    "     ferfusion_con    F4M1PB_4C          ",
    "                                         ",
    "     group_fix        fix_4C             ",
    "                                         ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  # id-cols with reps - add to IDs fails correctly
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      y      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     M      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "     1003     M      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1004     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  ADD_DATA",
    "",
    "",
    "      variables            1001                 1002                1003                1004         ",
    "    ===============  ==================  ==================  ==================  ==================  ",
    "",
    "     y                F                   F                   M                   M                  ",
    "                                                                                                     ",
    "     dt-g             31.1                32.2                33.3                34.4               ",
    "                                                                                                     ",
    "     derfuse_dt       2020-01-01:12:01    2020-01-01:12:02    2020-01-01:12:03    2020-01-01:12:04   ",
    "                                                                                                     ",
    "     derfusion_con    F4M1PB_4C           F4M2PB_4C           F4M3PB_4C           F4M4PB_4C          ",
    "                                                                                                     ",
    "     group_dix        dix_RT              dix_RT              dix_4C              dix_4C             ",
    "                                                                                                     ",
    "",
    "+===============================================================================",
    "")
  expect_error(datatable_read_vector(contents))
  # [x] CORRECT FAILURE


  #### timetable ####

  # test add data - timetable
  contents <- c("",
                "+===============================================================================",
                "",
                "",
                "    samples  :  CREATE",
                "",
                "",
                "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
                "    ======  =====  ========  ====================  =================  =============  ",
                "",
                "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
                "                                                                                     ",
                "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
                "                                                                                     ",
                "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
                "                                                                                     ",
                "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
                "                                                                                     ",
                "",
                "+===============================================================================",
                "",
                "",
                "+===============================================================================",
                "",
                "",
                "    samples  :  ADD_DATA",
                "",
                "",
                "     timetable     fix_4C      fix_RT          delip_dt        ",
                "    ===========  ==========  ==========  ====================  ",
                "",
                "        0:00        HT_RT       HT_RT      2024-01-01:12:00    ",
                "                                                               ",
                "        0:10        MT_RT                  2024-01-01:12:10    ",
                "                                                               ",
                "        0:20       DMT_RT       MT_RT      2024-01-01:12:20    ",
                "                                                               ",
                "        0:30        MT_RT                  2024-01-01:12:30    ",
                "                                                               ",
                "        0:40        HT_RT      DMT_RT      2024-01-01:12:40    ",
                "                                                               ",
                "        0:50       PBS_RT                  2024-01-01:12:50    ",
                "                                                               ",
                "        1:00                    MT_RT      2024-01-01:13:00    ",
                "                                                               ",
                "        1:20                    HT_RT      2024-01-01:13:20    ",
                "                                                               ",
                "        1:40                   PBS_RT      2024-01-01:13:40    ",
                "                                                               ",
                "",
                "+===============================================================================",
                "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads ADD_DATA timetable plaintext datatable correctly

})


test_that("datatable_read_vector() : GROUP Datatables", {

  # test datatable_read_vector() can read all types of datatable into tibbles correctly
  # testing all kinds of data permutations

  # test reading GROUP :

  #### no reps ####

  # reading GROUP Datatable - no rep
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  GROUP",
    "",
    "",
    "      ID      group-solvent-inc      group-ab-conc    ",
    "    ======  =====================  =================  ",
    "",
    "     1001            1Hr                 1mg/mL       ",
    "                                                      ",
    "     1002            2Hr                0.5mg/mL      ",
    "                                                      ",
    "     1003            4Hr                 1mg/mL       ",
    "                                                      ",
    "     1004            1Hr                0.5mg/mL      ",
    "                                                      ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))


  #### reps ####

  # reading GROUP datatable - reps
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  GROUP",
    "",
    "",
    "      ID     rep       group-solvent-inc      group-ab-conc    ",
    "    ======  =====    =====================  =================  ",
    "",
    "     1001    1                1Hr                 1mg/mL       ",
    "                                                      ",
    "     1001    2                2Hr                 1mg/mL       ",
    "                                                      ",
    "     1001    3                3Hr                 1mg/mL       ",
    "                                                      ",
    "     1002    1                1Hr                0.5mg/mL      ",
    "                                                      ",
    "     1002    2                2Hr                0.5mg/mL      ",
    "                                                      ",
    "     1002    3                3Hr                0.5mg/mL      ",
    "                                                      ",
    "     1003    1                1Hr                 1mg/mL       ",
    "                                                      ",
    "     1003    2                2Hr                 1mg/mL       ",
    "                                                      ",
    "     1003    3                3Hr                 1mg/mL       ",
    "                                                      ",
    "     1004    1                1Hr                0.5mg/mL      ",
    "                                                      ",
    "     1004    2                2Hr                0.5mg/mL      ",
    "                                                      ",
    "     1004    3                3Hr                0.5mg/mL      ",
    "                                                      ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads GROUP plaintext datatable

  # reading GROUP datatable - reps summarised
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  GROUP",
    "",
    "",
    "      ID     rep       group-solvent-inc      group-ab-conc    ",
    "    ======  =====    =====================  =================  ",
    "",
    "     1001    1:3              1Hr                 1mg/mL       ",
    "                                                      ",
    "     1002    1:3              2Hr                0.5mg/mL      ",
    "                                                      ",
    "     1003    1:3              4Hr                 1mg/mL       ",
    "                                                      ",
    "     1004    1:3              1Hr                0.5mg/mL      ",
    "                                                      ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads GROUP plaintext datatable


  # reading GROUP datatable - reps ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt-g         perfuse_dt         perfusion_con      group-fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      31.1      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      32.2      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      33.3      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      34.4      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  GROUP",
    "",
    "",
    "      ID     rep       group-solvent-inc      group-ab-conc    ",
    "    ======  =====    =====================  =================  ",
    "",
    "     1001    ALL              1Hr                 1mg/mL       ",
    "                                                      ",
    "     1002    ALL              2Hr                0.5mg/mL      ",
    "                                                      ",
    "     1003    ALL              4Hr                 1mg/mL       ",
    "                                                      ",
    "     1004    ALL              1Hr                0.5mg/mL      ",
    "                                                      ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads GROUP plaintext datatable

})



test_that("datatable_read_vector() : EXPORT Datatables", {

  # read EXPORT Datatable

  #### no reps ####

  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  EXPORT",
    "",
    "",
    "      ID                export              ",
    "    ======  ==============================  ",
    "",
    "     1001     ../dest-note/dest-note~001    ",
    "                                            ",
    "     1002     ../dest-note/dest-note~001    ",
    "                                            ",
    "     1003     ../dest-note/dest-note~001    ",
    "                                            ",
    "     1004     ../dest-note/dest-note~001     ",
    "                                                      ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads EXPORT plaintext datatable


  # read EXPORT Datatable : long import source path
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  EXPORT",
    "",
    "",
    "      ID                                export                         ",
    "    ======  =========================================================  ",
    "",
    "     1001     ../../../../../programme-path/project-doc-path/project-  ",
    "              note-path/note-sub-path/dest-note/dest-note~001         ",
    "                                                                       ",
    "     1002     ../../../../../programme-path/project-doc-path/project-  ",
    "              note-path/note-sub-path/dest-note/dest-note~001         ",
    "                                                                       ",
    "     1003     ../../../../../programme-path/project-doc-path/project-  ",
    "              note-path/note-sub-path/dest-note/dest-note~001         ",
    "                                                                       ",
    "     1004     ../../../../../programme-path/project-doc-path/project-  ",
    "              note-path/note-sub-path/dest-note/dest-note~001         ",
    "                                                                       ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads EXPORT plaintext datatable


  # read EXPORT Datatable : long import source path 02
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  EXPORT",
    "",
    "",
    "      ID                                export                     ",
    "    ======  =====================================================  ",
    "",
    "     1001   ../../../../../programme-path/project-doc-path/projec  ",
    "              t-note-path/note-sub-path/dest-note/dest-note~001    ",
    "                                                                   ",
    "     1002   ../../../../../programme-path/project-doc-path/projec  ",
    "              t-note-path/note-sub-path/dest-note/dest-note~001    ",
    "                                                                   ",
    "     1003   ../../../../../programme-path/project-doc-path/projec  ",
    "              t-note-path/note-sub-path/dest-note/dest-note~001    ",
    "                                                                   ",
    "     1004   ../../../../../programme-path/project-doc-path/projec  ",
    "              t-note-path/note-sub-path/dest-note/dest-note~001    ",
    "                                                                   ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))


  #### reps ####

  # read EXPORT Datatable - reps
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  EXPORT",
    "",
    "",
    "      ID     rep               export              ",
    "    ======  =====  ==============================  ",
    "",
    "     1001     1      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1001     2      ../dest-note/dest-note~002    ",
    "                                                   ",
    "     1001     3      ../dest-note/dest-note~003    ",
    "                                                   ",
    "     1002     1      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1002     2      ../dest-note/dest-note~002    ",
    "                                                   ",
    "     1002     3      ../dest-note/dest-note~003    ",
    "                                                   ",
    "     1003     1      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1003     2      ../dest-note/dest-note~002    ",
    "                                                   ",
    "     1003     3      ../dest-note/dest-note~003    ",
    "                                                   ",
    "     1004     1      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1004     2      ../dest-note/dest-note~002    ",
    "                                                   ",
    "     1004     3      ../dest-note/dest-note~003    ",
    "                                                   ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads EXPORT plaintext datatable


  # read EXPORT Datatable - reps summarised
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  EXPORT",
    "",
    "",
    "      ID     rep               export              ",
    "    ======  =====  ==============================  ",
    "",
    "     1001    1:3      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1002    1:3      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1003    1:3      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1004    1:3      ../dest-note/dest-note~001    ",
    "                                                   ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads EXPORT plaintext datatable


  # read EXPORT Datatable - reps ALL
  contents <- c(
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  CREATE",
    "",
    "",
    "      ID      x      wt_g         perfuse_dt         perfusion_con      group_fix    ",
    "    ======  =====  ========  ====================  =================  =============  ",
    "",
    "     1001     F      30.0      2020-01-01:12:01        F4M1PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1002     F      31.1      2020-01-01:12:02        F4M2PB_RT          fix_RT     ",
    "                                                                                     ",
    "     1003     M      32.2      2020-01-01:12:03        F4M3PB_4C          fix_4C     ",
    "                                                                                     ",
    "     1004     M      33.3      2020-01-01:12:04        F4M4PB_4C          fix_4C     ",
    "                                                                                     ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples  :  RESAMPLE",
    "",
    "",
    "      ID     resample    reps    ",
    "    ======  ==========  =======  ",
    "",
    "     1001     CNS          3     ",
    "                                 ",
    "     1002     CNS          3     ",
    "                                 ",
    "     1003     CNS          3     ",
    "                                 ",
    "     1004     CNS          3     ",
    "                                 ",
    "",
    "+===============================================================================",
    "",
    "",
    "+===============================================================================",
    "",
    "",
    "    samples_CNS  :  EXPORT",
    "",
    "",
    "      ID     rep               export              ",
    "    ======  =====  ==============================  ",
    "",
    "     1001    ALL      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1002    ALL      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1003    ALL      ../dest-note/dest-note~001    ",
    "                                                   ",
    "     1004    ALL      ../dest-note/dest-note~001    ",
    "                                                   ",
    "",
    "+===============================================================================",
    "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads EXPORT plaintext datatable

})


test_that("datatable_read_vector() : IMPORT Datatables", {

  # read IMPORT Datatable

  #### no reps ####
  contents <- c("",
                "+===============================================================================",
                "",
                "",
                "    samples  :  IMPORT",
                "",
                "",
                "      ID                  import                ",
                "    ======  ==================================  ",
                "",
                "     1001     ../source-note/source-note~001    ",
                "                                                ",
                "     1002     ../source-note/source-note~001    ",
                "                                                ",
                "     1003     ../source-note/source-note~001    ",
                "                                                ",
                "     1004     ../source-note/source-note~001    ",
                "                                                ",
                "",
                "+===============================================================================",
                "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads IMPORT plaintext datatable



  # read IMPORT Datatable : long import source path
  contents <- c("",
                "+===============================================================================",
                "",
                "",
                "    samples  :  IMPORT",
                "",
                "",
                "      ID                                import                         ",
                "    ======  =========================================================  ",
                "",
                "     1001     ../../../../../programme-path/project-doc-path/project-  ",
                "              note-path/note-sub-path/source-note/source-note~001      ",
                "                                                                       ",
                "     1002     ../../../../../programme-path/project-doc-path/project-  ",
                "              note-path/note-sub-path/source-note/source-note~001      ",
                "                                                                       ",
                "     1003     ../../../../../programme-path/project-doc-path/project-  ",
                "              note-path/note-sub-path/source-note/source-note~001      ",
                "                                                                       ",
                "     1004     ../../../../../programme-path/project-doc-path/project-  ",
                "              note-path/note-sub-path/source-note/source-note~001      ",
                "                                                                       ",
                "",
                "+===============================================================================",
                "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads IMPORT plaintext datatable



  #### reps ####

  # read IMPORT Datatable - reps
  contents <- c("",
                "+===============================================================================",
                "",
                "",
                "    samples  :  IMPORT",
                "",
                "",
                "      ID     rep               import                  ",
                "    ======  =====  ==================================  ",
                "",
                "     1001    1       ../source-note/source-note~001    ",
                "                                                       ",
                "     1001    2       ../source-note/source-note~001    ",
                "                                                       ",
                "     1001    3       ../source-note/source-note~001    ",
                "                                                       ",
                "     1002    1       ../source-note/source-note~001    ",
                "                                                       ",
                "     1002    2       ../source-note/source-note~001    ",
                "                                                       ",
                "     1002    3       ../source-note/source-note~001    ",
                "                                                       ",
                "     1003    1       ../source-note/source-note~001    ",
                "                                                       ",
                "     1003    2       ../source-note/source-note~001    ",
                "                                                       ",
                "     1003    3       ../source-note/source-note~001    ",
                "                                                       ",
                "     1004    1       ../source-note/source-note~001    ",
                "                                                       ",
                "     1004    2       ../source-note/source-note~001    ",
                "                                                       ",
                "     1004    3       ../source-note/source-note~001    ",
                "                                                       ",
                "",
                "+===============================================================================",
                "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads IMPORT plaintext datatable


  # read IMPORT Datatable - reps summarised - properly expanded
  contents <- c("",
                "+===============================================================================",
                "",
                "",
                "    samples  :  IMPORT",
                "",
                "",
                "      ID     rep               import                  ",
                "    ======  =====  ==================================  ",
                "",
                "     1001    1:3     ../source-note/source-note~001    ",
                "                                                       ",
                "     1002    1:3     ../source-note/source-note~002    ",
                "                                                       ",
                "     1003    1:3     ../source-note/source-note~003    ",
                "                                                       ",
                "     1004    1:3     ../source-note/source-note~004    ",
                "                                                       ",
                "",
                "+===============================================================================",
                "")
  expect_snapshot(datatable_read_vector(contents))
  # [x] SUCCESS
  # reads IMPORT plaintext datatable



})
